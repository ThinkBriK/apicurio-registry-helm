{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/eshepelyuk/apicurio-registry-helm-chart",
  "title": "Apicurio Registry Helm values",
  "definitions": {
    "isEnabled": {
      "type": "boolean",
      "title": "should be installed",
      "default": true
    },
    "dockerImage": {
      "type": "object",
      "title": "docker image settings",
      "required": [
        "registry",
        "repository",
        "tag"
      ],
      "properties": {
        "registry": {
          "type": "string",
          "default": "quay.io"
        },
        "repository": {
          "type": "string"
        },
        "tag": {
          "type": "string"
        }
      }
    },
    "podResources": {
      "type": "object",
      "title": "pod resources",
      "additionalProperties": false,
      "properties": {
        "limits": {
          "type": "object"
        },
        "requests": {
          "type": "object"
        }
      }
    },
    "persistence": {
      "choice": {
        "type": "string",
        "pattern": "^(memory|kafka|sql)$",
        "default": "memory",
        "title": "Type of persistence for apicurio registry"
      },
      "kafka": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "bootstrapServers"
        ],
        "properties": {
          "bootstrapServers": {
            "type": "string"
          }
        }
      },
      "sql": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "url",
          "existingSecret",
          "existingSecretUsernameKey",
          "existingSecretPasswordKey"
        ],
        "properties": {
          "url": {
            "type": "string"
          },
          "existingSecret": {
            "type": "string",
            "default": "apicurio-registry-sync-db",
            "title": "Name of existing secret containing SQL credentials for apicurio"
          },
          "existingSecretUsernameKey": {
            "type": "string",
            "default": "username",
            "title": "Key in the existing secret containing SQL username for apicurio"
          },
          "existingSecretPasswordKey": {
            "type": "string",
            "default": "password",
            "title": "Key in the existing secret containing SQL password for apicurio"
          }
        }
      }
    },
    "keyValue": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "name",
        "value"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      }
    },
    "service": {
      "type": "object",
      "title": "service resource for registry",
      "require": [
        "type"
      ],
      "properties": {
        "type": {
          "type": "string",
          "default": "ClusterIP",
          "title": "service type"
        }
      }
    },
    "ingress": {
      "type": "object",
      "title": "ingress resource for registry",
      "required": [
        "enabled",
        "host",
        "path"
      ],
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "title": "enable ingress resource"
        },
        "host": {
          "type": "string",
          "default": "apicurio.local",
          "title": "hostname"
        },
        "path": {
          "type": "string",
          "default": "/",
          "title": "ingress path"
        },
        "pathType": {
          "type": "string",
          "default": "ImplementationSpecific",
          "title": "ingress path type"
        },
        "tls": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "enabled"
          ],
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "title": "Enable TLS for the ingress"
            },
            "secretName": {
              "type": "string",
              "title": "Name of the TLS secret to be used (defaults to ingress address)"
            }
          }
        },
        "annotations": {
          "type": "object",
          "default": {},
          "title": "ingress resource annotations"
        },
        "labels": {
          "type": "object",
          "default": {},
          "title": "ingress resource labels"
        }
      }
    }
  },
  "type": "object",
  "properties": {
    "registry": {
      "type": "object",
      "title": "registry settings",
      "required": [
        "enabled",
        "persistence",
        "image",
        "resources",
        "ingress"
      ],
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "$ref": "#/definitions/isEnabled"
        },
        "image": {
          "$ref": "#/definitions/dockerImage"
        },
        "extraEnv": {
          "type": "array",
          "default": [],
          "items": {
            "$ref": "#/definitions/keyValue"
          }
        },
        "resources": {
          "$ref": "#/definitions/podResources"
        },
        "nodeSelector": {
          "type": "object",
          "title": "pod node selector"
        },
        "affinity": {
          "type": "object",
          "title": "pod affinity"
        },
        "tolerations": {
          "type": "array",
          "default": [],
          "items": {
            "type": "object",
            "title": "pod tolerations"
          }
        },
        "kafka": {
          "$ref": "#/definitions/persistence/kafka"
        },
        "sql": {
          "$ref": "#/definitions/persistence/sql"
        },
        "persistence": {
          "$ref": "#/definitions/persistence/choice"
        },
        "service": {
          "$ref": "#/definitions/service"
        },
        "ingress": {
          "$ref": "#/definitions/ingress"
        }
      }
    },
    "sync": {
      "type": "object",
      "title": "registry content sync settings",
      "required": [
        "enabled",
        "image",
        "resources"
      ],
      "properties": {
        "enabled": {
          "$ref": "#/definitions/isEnabled"
        },
        "image": {
          "$ref": "#/definitions/dockerImage"
        },
        "resources": {
          "$ref": "#/definitions/podResources"
        },
        "registryUrl": {
          "type": [
            "null",
            "string"
          ],
          "default": null
        }
      }
    }
  }
}
